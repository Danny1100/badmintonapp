<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <div class="container-fluid p-3">
      <div class="court-list-container">
        @for (court of courts$ | async; track court.courtNumber) {
          <div>
            <div class="court-container mb-3">
              <app-court
                [courtNumber]="court.courtNumber"
                [players]="court.players"
              ></app-court>
            </div>
          </div>
        }
      </div>
      <div class="add-court-container mb-3">
        <app-add-court></app-add-court>
      </div>
      <!-- TODO: add run matchmaking component
      <div class="run-matchmaking-container mb-3">
        <app-run-matchmaking></app-run-matchmaking>
      </div> -->
      <div cdkDropListGroup>
        <div class="queued-groups-container">
          @if ((matchmakingQueuedGroups$ | async)?.length) {
            <h2 class="mb-3">Queued Groups</h2>
          }
          <div class="queued-groups-list-container my-3 mx-3">
            @for (
              group of matchmakingQueuedGroups$ | async;
              track group;
              let groupIndex = $index
            ) {
              <div class="waiting-group mx-3 mb-3">
                <p class="waiting-group-number">{{ groupIndex + 1 }}.</p>
                <div
                  class="waiting-group-players-container"
                  cdkDropList
                  [cdkDropListData]="group"
                  (cdkDropListDropped)="drop($event)"
                  cdkDropListSortingDisabled
                >
                  @for (
                    player of group;
                    track player.id;
                    let playerIndex = $index
                  ) {
                    <div class="waiting-group-list-item" cdkDrag>
                      <div
                        class="dragging-placeholder"
                        *cdkDragPlaceholder
                      ></div>
                      <div class="player-container">
                        <app-player
                          [id]="player.id"
                          [name]="player.name"
                          [skillId]="player.skillId"
                        ></app-player>
                      </div>
                    </div>
                  }
                </div>
              </div>
              <hr />
            }
          </div>
        </div>
        <div class="non-matchmade-players-container">
          @if ((nonMatchmadePlayers$ | async)?.length) {
            <h2 class="mb-3">Not Queued Players</h2>
          }
          <div
            class="non-matchmade-players-list-container my-3 mx-3"
            cdkDropList
            cdkDropListOrientation="mixed"
            [cdkDropListData]="(nonMatchmadePlayers$ | async) ?? []"
            (cdkDropListDropped)="drop($event)"
            cdkDropListSortingDisabled
          >
            @for (
              player of nonMatchmadePlayers$ | async;
              track player.id;
              let playerIndex = $index
            ) {
              <div class="non-matchmade-player mx-3" cdkDrag>
                <div class="dragging-placeholder" *cdkDragPlaceholder></div>
                <p class="non-matchmade-player-number">
                  {{ playerIndex + 1 }}.
                </p>
                <div
                  class="player-container"
                  (dblclick)="moveNonMatchmadePlayerToMatchmakingQueue(player)"
                >
                  <app-player
                    [id]="player.id"
                    [name]="player.name"
                    [skillId]="player.skillId"
                  ></app-player>
                </div>
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
